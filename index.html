<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ö‡∏ö‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡πâ‡∏≤‡∏ô ‡∏Å.‡∏ó.‡∏ß.</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.all.min.js"></script>
    
    <!-- SheetJS for Excel Export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #fff5f0 0%, #ffe8dc 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(255, 107, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ff6b00 0%, #ff8c3a 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.95;
        }
        
        .admin-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .admin-icon:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }
        
        .admin-icon svg {
            width: 24px;
            height: 24px;
            fill: white;
        }
        
        .logo-container {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
            align-items: center;
        }
        
        .logo-container img {
            max-height: 80px;
            background: white;
            padding: 10px;
            border-radius: 10px;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #ff6b00;
        }
        
        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .tab:hover {
            background: rgba(255, 107, 0, 0.05);
            color: #ff6b00;
        }
        
        .tab.active {
            color: #ff6b00;
            background: white;
            border-bottom-color: #ff6b00;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }
        
        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group input[type="url"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            font-family: 'Sarabun', sans-serif;
            transition: all 0.3s;
            background: white;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ff6b00;
            box-shadow: 0 0 0 3px rgba(255, 107, 0, 0.1);
            background: #fffbf7;
        }
        
        .form-group input:hover,
        .form-group select:hover,
        .form-group textarea:hover {
            border-color: #ffa64d;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .radio-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .radio-group input[type="radio"] {
            width: 20px;
            height: 20px;
            accent-color: #ff6b00;
        }
        
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 10px;
        }
        
        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            font-weight: 500;
            padding: 10px;
            border-radius: 8px;
            transition: background 0.3s;
        }
        
        .checkbox-group label:hover {
            background: rgba(255, 107, 0, 0.05);
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #ff6b00;
        }
        
        .dynamic-fields {
            margin-top: 15px;
            padding: 25px;
            background: linear-gradient(135deg, #fff5f0 0%, #ffe8dc 100%);
            border-radius: 12px;
            border-left: 4px solid #ff6b00;
            box-shadow: 0 2px 10px rgba(255, 107, 0, 0.1);
        }
        
        .dynamic-fields h4 {
            color: #ff6b00;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
        }
        
        .dynamic-field-item {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
        }
        
        .dynamic-field-item:hover {
            box-shadow: 0 4px 12px rgba(255, 107, 0, 0.15);
            transform: translateY(-2px);
        }
        
        .dynamic-field-item h4 {
            grid-column: 1 / -1;
            color: #ff6b00;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Sarabun', sans-serif;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ff6b00 0%, #ff8c3a 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 0, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 0, 0.4);
        }
        
        .btn-print {
            background: linear-gradient(135deg, #4CAF50 0%, #66BB6A 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-print:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
        
        .btn-print svg {
            width: 20px;
            height: 20px;
            fill: white;
        }
        
        .btn-secondary {
            background: white;
            color: #ff6b00;
            border: 2px solid #ff6b00;
        }
        
        .btn-secondary:hover {
            background: #ff6b00;
            color: white;
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #ff6b00 0%, #ff8c3a 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(255, 107, 0, 0.2);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(255, 107, 0, 0.3);
        }
        
        .stat-card:nth-child(2) {
            background: linear-gradient(135deg, #4CAF50 0%, #66BB6A 100%);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.2);
        }
        
        .stat-card:nth-child(2):hover {
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
        }
        
        .stat-card:nth-child(3) {
            background: linear-gradient(135deg, #2196F3 0%, #42A5F5 100%);
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.2);
        }
        
        .stat-card:nth-child(3):hover {
            box-shadow: 0 8px 25px rgba(33, 150, 243, 0.3);
        }
        
        .stat-card h3 {
            font-size: 42px;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .stat-card p {
            font-size: 16px;
            opacity: 0.95;
            font-weight: 500;
        }
        
        .chart-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
            border: 1px solid #f0f0f0;
        }
        
        .chart-container h3 {
            color: #ff6b00;
            font-weight: 600;
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        .table-container {
            overflow-x: auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #f0f0f0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: linear-gradient(135deg, #ff6b00 0%, #ff8c3a 100%);
            color: white;
        }
        
        thead th {
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 15px;
            text-align: center;
        }
        
        tbody tr {
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s;
        }
        
        tbody tr:hover {
            background: linear-gradient(to right, rgba(255, 107, 0, 0.05), rgba(255, 107, 0, 0.02));
            transform: scale(1.01);
        }
        
        tbody td {
            padding: 15px;
            font-size: 15px;
        }
        
        tbody tr:last-child {
            border-bottom: none;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn-small {
            padding: 6px 15px;
            font-size: 14px;
            border-radius: 6px;
        }
        
        .btn-edit {
            background: linear-gradient(135deg, #4CAF50 0%, #66BB6A 100%);
            color: white;
            transition: all 0.3s;
        }
        
        .btn-edit:hover {
            background: linear-gradient(135deg, #45a049 0%, #5cb85c 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }
        
        .btn-delete {
            background: linear-gradient(135deg, #f44336 0%, #e57373 100%);
            color: white;
            transition: all 0.3s;
        }
        
        .btn-delete:hover {
            background: linear-gradient(135deg, #d32f2f 0%, #ef5350 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.3s;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-content h2 {
            color: #ff6b00;
            margin-bottom: 20px;
        }
        
        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            color: #999;
            cursor: pointer;
            line-height: 20px;
        }
        
        .close:hover {
            color: #ff6b00;
        }
        
        .alert {
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            
            #printArea, #printArea * {
                visibility: visible;
            }
            
            #printArea {
                position: absolute;
                left: 0;
                top: 0;
                width: 210mm;
                min-height: 297mm;
                background: white !important;
            }
            
            .no-print {
                display: none !important;
            }
            
            * {
                box-shadow: none !important;
                background: transparent !important;
                border: none !important;
            }
            
            .print-document {
                background: white !important;
                box-shadow: none !important;
            }
            
            .print-table, .print-table * {
                background: white !important;
            }
            
            .print-table th {
                background: #808080 !important;
                color: white !important;
                border: 1px solid #000 !important;
            }
            
            .print-table td {
                border: 1px solid #000 !important;
            }
        }
        
        .print-document {
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            background: white;
            margin: 20px auto;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        .print-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .print-header img {
            max-height: 80px;
            margin-bottom: 10px;
        }
        
        .print-header h2 {
            font-size: 20px;
            margin: 5px 0;
        }
        
        .print-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }
        
        .print-table th,
        .print-table td {
            border: 1px solid #000;
            padding: 6px 8px;
            text-align: left;
        }
        
        .print-table th {
            background: #808080;
            font-weight: 600;
            text-align: center;
            font-size: 14px;
            color: white;
        }
        
        .print-table td {
            font-size: 13px;
        }
        
        .signature-section {
            margin-top: 40px;
            display: flex;
            justify-content: space-between;
        }
        
        .signature-box {
            text-align: center;
        }
        
        .signature-line {
            border-top: 1px dotted #000;
            width: 200px;
            margin: 40px auto 10px;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 22px;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .dynamic-field-item {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn-group .btn {
                width: 100%;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .phone-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
        
        .btn-group.no-print {
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .hidden {
            display: none;
        }
        
        .phone-icon {
            cursor: pointer;
            color: #4CAF50;
            font-size: 20px;
            transition: all 0.3s;
        }
        
        .phone-icon:hover {
            color: #ff6b00;
            transform: scale(1.2);
        }
        
        .phone-item {
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #4CAF50;
        }
        
        .phone-item strong {
            color: #333;
            font-size: 16px;
        }
        
        .phone-number {
            font-size: 18px;
            color: #ff6b00;
            font-weight: 600;
        }
        
        .copy-btn {
            padding: 8px 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .copy-btn:hover {
            background: #45a049;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="admin-icon" onclick="openAdminModal()">
                <svg viewBox="0 0 24 24">
                    <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" />
                </svg>
            </div>
            <div class="logo-container" id="headerLogos" style="margin-top: 0; margin-bottom: 15px;">
                <img src="https://nonthaphathr.github.io/uploadimg/logoschool.png" alt="‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏∏‡∏°‡∏ó‡∏≠‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤">
            </div>
            <h1 style="font-size: 24px;">‡πÅ‡∏ö‡∏ö‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ ‡∏Å.‡∏ó.‡∏ß.</h1>
            <h1 style="font-size: 24px; margin-top: 5px;">‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 2568</h1>
            <p style="margin-top: 10px;">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏∏‡∏°‡∏ó‡∏≠‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤ ‡∏ï‡∏≥‡∏ö‡∏•‡∏´‡∏ô‡∏≠‡∏á‡∏´‡∏±‡∏ß‡∏ä‡πâ‡∏≤‡∏á ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏Å‡∏±‡∏ô‡∏ó‡∏£‡∏≤‡∏£‡∏°‡∏¢‡πå ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©</p>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab(0)">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
            <div class="tab" onclick="switchTab(1)">‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
        </div>
        
        <!-- Tab 1: Form -->
        <div class="tab-content active" id="tab0">
            <form id="mainForm">
                <div class="form-group">
                    <label>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô *</label>
                    <input type="text" id="schoolName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡∏≠‡∏á‡∏î‡∏∏‡∏°‡∏´‡∏ô‡∏≠‡∏á‡∏°‡πà‡∏ß‡∏á" required>
                </div>
                
                <div class="form-group">
                    <label>‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô *</label>
                    <div style="display: grid; grid-template-columns: 150px 1fr 1fr; gap: 10px;">
                        <select id="directorPrefix" required>
                            <option value="">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</option>
                            <option value="‡∏ô‡∏≤‡∏¢">‡∏ô‡∏≤‡∏¢</option>
                            <option value="‡∏ô‡∏≤‡∏á">‡∏ô‡∏≤‡∏á</option>
                            <option value="‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß">‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option>
                            <option value="‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≠‡∏¢‡∏ï‡∏£‡∏µ">‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≠‡∏¢‡∏ï‡∏£‡∏µ</option>
                            <option value="‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏ô‡∏ï‡∏£‡∏µ">‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏ô‡∏ï‡∏£‡∏µ</option>
                        </select>
                        <input type="text" id="directorFirstName" placeholder="‡∏ä‡∏∑‡πà‡∏≠" required>
                        <input type="text" id="directorLastName" placeholder="‡∏™‡∏Å‡∏∏‡∏•" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏±‡πâ‡∏ô ‡∏õ.6 (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô) *</label>
                    <input type="number" id="totalStudents" min="0" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" required>
                </div>
                
                <div class="form-group">
                    <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå *</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="intention" value="join" onchange="toggleIntentionFields()"> 
                            ‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏ô‡∏≥‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
                        </label>
                        <label>
                            <input type="radio" name="intention" value="notjoin" onchange="toggleIntentionFields()"> 
                            ‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
                        </label>
                    </div>
                </div>
                
                <div class="form-group hidden" id="joinCountGroup">
                    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</label>
                    <input type="number" id="joinCount" min="0">
                </div>
                
                <div class="form-group hidden" id="notJoinReasonGroup">
                    <label>‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å</label>
                    <textarea id="notJoinReason" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô) *</label>
                    <input type="number" id="teacherCount" min="0" value="0" oninput="generateTeacherFields()">
                </div>
                
                <div id="teacherFields"></div>
                
                <div class="form-group">
                    <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏™‡πà‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î</label>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="contestSinging" onchange="toggleContestField('singing')">
                            ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á‡∏•‡∏π‡∏Å‡∏ó‡∏∏‡πà‡∏á
                        </label>
                        <label>
                            <input type="checkbox" id="contestTakraw" onchange="toggleContestField('takraw')">
                            ‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÄ‡∏î‡∏≤‡∏∞‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠
                        </label>
                    </div>
                    <div style="margin-top: 15px;">
                        <a href="#" id="contestCriteriaLink" onclick="openCriteriaLink(event)" style="color: #ff6b00; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 8px;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                            ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î
                        </a>
                    </div>
                </div>
                
                <div id="singingFields" class="hidden">
                    <div class="dynamic-fields">
                        <h4>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á‡∏•‡∏π‡∏Å‡∏ó‡∏∏‡πà‡∏á</h4>
                        <div class="dynamic-field-item">
                            <div class="form-group">
                                <label>‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label>
                                <select id="singingPrefix">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</option>
                                    <option value="‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢">‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢</option>
                                    <option value="‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á">‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡∏ä‡∏∑‡πà‡∏≠</label>
                                <input type="text" id="singingFirstName" placeholder="‡∏ä‡∏∑‡πà‡∏≠">
                            </div>
                            <div class="form-group">
                                <label>‡∏™‡∏Å‡∏∏‡∏•</label>
                                <input type="text" id="singingLastName" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                            </div>
                            <div class="form-group">
                                <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label>
                                <input type="text" id="singingGrade" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ.6">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="takrawFields" class="hidden">
                    <div class="dynamic-fields">
                        <h4>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÄ‡∏î‡∏≤‡∏∞‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠</h4>
                        <div class="dynamic-field-item">
                            <div class="form-group">
                                <label>‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label>
                                <select id="takrawPrefix">
                                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</option>
                                    <option value="‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢">‡πÄ‡∏î‡πá‡∏Å‡∏ä‡∏≤‡∏¢</option>
                                    <option value="‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á">‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>‡∏ä‡∏∑‡πà‡∏≠</label>
                                <input type="text" id="takrawFirstName" placeholder="‡∏ä‡∏∑‡πà‡∏≠">
                            </div>
                            <div class="form-group">
                                <label>‡∏™‡∏Å‡∏∏‡∏•</label>
                                <input type="text" id="takrawLastName" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                            </div>
                            <div class="form-group">
                                <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label>
                                <input type="text" id="takrawGrade" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ.6">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    <button type="button" class="btn btn-secondary" onclick="clearForm()">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            </form>
        </div>
        
        <!-- Tab 2: Summary -->
        <div class="tab-content" id="tab1">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="statSchools">0</h3>
                    <p>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö</p>
                </div>
                <div class="stat-card">
                    <h3 id="statStudents">0</h3>
                    <p>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</p>
                </div>
                <div class="stat-card">
                    <h3 id="statContestants">0</h3>
                    <p>‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î</p>
                </div>
            </div>
            
            <div class="chart-container">
                <h3>üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                <canvas id="schoolChart"></canvas>
            </div>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <h3 style="color: #ff6b00; font-size: 22px; font-weight: 600; margin-bottom: 15px;">üìÑ ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h3>
            </div>
            
            <div class="btn-group no-print">
                <button class="btn btn-print" onclick="printRegistry('singing')">
                    <svg viewBox="0 0 24 24">
                        <path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/>
                    </svg>
                    ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á‡∏•‡∏π‡∏Å‡∏ó‡∏∏‡πà‡∏á
                </button>
                <button class="btn btn-print" onclick="printRegistry('takraw')">
                    <svg viewBox="0 0 24 24">
                        <path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/>
                    </svg>
                    ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÄ‡∏î‡∏≤‡∏∞‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠
                </button>
                <button class="btn btn-secondary" onclick="exportToExcel()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Excel
                </button>
            </div>
            
            <div style="text-align: center; margin: 40px 0 20px;">
                <h3 style="color: #ff6b00; font-size: 22px; font-weight: 600;">üìã ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                            <th>‡∏ô‡∏£.‡∏õ.6</th>
                            <th>‡∏ô‡∏£.‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</th>
                            <th>‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</th>
                            <th style="width: 60px;">‡πÇ‡∏ó‡∏£</th>
                            <th style="width: 80px;">‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á</th>
                            <th style="width: 80px;">‡πÄ‡∏î‡∏≤‡∏∞‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠</th>
                            <th style="width: 150px;">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="dataTable">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Admin Modal -->
    <div id="adminModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" onclick="closeAdminModal()">&times;</span>
            <h2 style="text-align: center; margin-bottom: 30px;">‚öôÔ∏è ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h2>
            <div id="adminPasswordSection">
                <div class="form-group">
                    <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <input type="password" id="adminPassword" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" style="text-align: center; font-size: 18px; letter-spacing: 3px;" onkeypress="handleAdminPasswordEnter(event)">
                </div>
                <button class="btn btn-primary" onclick="checkAdminPassword()" style="width: 100%; padding: 15px; font-size: 18px;">üîì ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
            <div id="adminPanel" class="hidden">
                <div class="form-group">
                    <label>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏á‡∏≤‡∏ô</label>
                    <input type="file" id="eventLogo" accept="image/*" onchange="uploadEventLogo()" style="padding: 10px;">
                    <div id="currentLogo" style="margin-top: 10px; text-align: center;"></div>
                </div>
                
                <div class="form-group">
                    <label>‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î</label>
                    <input type="url" id="criteriaLink" placeholder="https://example.com/criteria">
                    <small style="color: #666; display: block; margin-top: 5px;">‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</small>
                </div>
                
                <div class="form-group">
                    <label>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</label>
                    <textarea id="announcementText" rows="4" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô..."></textarea>
                </div>
                
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="showAnnouncement" style="width: 20px; height: 20px;">
                        <span>‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</span>
                    </label>
                </div>
                
                <button class="btn btn-primary" onclick="saveAdminSettings()" style="width: 100%; padding: 15px; font-size: 18px;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
            </div>
        </div>
    </div>
    
    <!-- Print Area -->
    <div id="printArea" style="display: none;"></div>
    
    <!-- Announcement Modal -->
    <div id="announcementModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAnnouncementModal()">&times;</span>
            <h2>‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</h2>
            <div id="announcementContent"></div>
            <button class="btn btn-primary" onclick="closeAnnouncementModal()" style="margin-top: 20px;">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö</button>
        </div>
    </div>
    
    <!-- Phone Modal -->
    <div id="phoneModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePhoneModal()">&times;</span>
            <h2>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h2>
            <div id="phoneList" style="margin: 20px 0;"></div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAK93TMVGezlP_y5TUdYy6iQ3j596ejUJc",
            authDomain: "openhouse2-4cdd5.firebaseapp.com",
            projectId: "openhouse2-4cdd5",
            databaseURL: "https://openhouse2-4cdd5-default-rtdb.asia-southeast1.firebasedatabase.app",
            storageBucket: "openhouse2-4cdd5.firebasestorage.app",
            messagingSenderId: "418038673273",
            appId: "1:418038673273:web:7e7a90e8d3793ac79989a8"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();
        
        let currentEditId = null;
        let chartInstance = null;
        
        // Tab Switching
        function switchTab(index) {
            document.querySelectorAll('.tab').forEach((tab, i) => {
                tab.classList.toggle('active', i === index);
            });
            document.querySelectorAll('.tab-content').forEach((content, i) => {
                content.classList.toggle('active', i === index);
            });
            
            if (index === 1) {
                loadSummaryData();
            }
        }
        
        // Toggle Intention Fields
        function toggleIntentionFields() {
            const intention = document.querySelector('input[name="intention"]:checked')?.value;
            const joinCountGroup = document.getElementById('joinCountGroup');
            const notJoinReasonGroup = document.getElementById('notJoinReasonGroup');
            
            if (intention === 'join') {
                joinCountGroup.classList.remove('hidden');
                notJoinReasonGroup.classList.add('hidden');
                // Clear auto-filled "-"
                document.getElementById('joinCount').value = '';
            } else if (intention === 'notjoin') {
                joinCountGroup.classList.add('hidden');
                notJoinReasonGroup.classList.remove('hidden');
                // Auto-fill "-" for join count
                document.getElementById('joinCount').value = 0;
                
                // Auto-fill "-" for teacher count if empty
                if (!document.getElementById('teacherCount').value) {
                    document.getElementById('teacherCount').value = 0;
                }
                
                // Uncheck contests
                document.getElementById('contestSinging').checked = false;
                document.getElementById('contestTakraw').checked = false;
                toggleContestField('singing');
                toggleContestField('takraw');
            } else {
                joinCountGroup.classList.add('hidden');
                notJoinReasonGroup.classList.add('hidden');
            }
        }
        
        // Generate Teacher Fields (State Preserving)
        function generateTeacherFields() {
            const count = parseInt(document.getElementById('teacherCount').value) || 0;
            const container = document.getElementById('teacherFields');
            
            // Preserve existing data
            const existingData = [];
            container.querySelectorAll('.dynamic-field-item').forEach((item, index) => {
                existingData[index] = {
                    prefix: item.querySelector(`#teacherPrefix${index}`)?.value || '',
                    firstName: item.querySelector(`#teacherFirstName${index}`)?.value || '',
                    lastName: item.querySelector(`#teacherLastName${index}`)?.value || '',
                    phone: item.querySelector(`#teacherPhone${index}`)?.value || ''
                };
            });
            
            // Clear and regenerate
            container.innerHTML = '';
            
            if (count > 0) {
                container.innerHTML = '<div class="dynamic-fields"><h4>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h4></div>';
                const fieldsContainer = container.querySelector('.dynamic-fields');
                
                for (let i = 0; i < count; i++) {
                    const fieldItem = document.createElement('div');
                    fieldItem.className = 'dynamic-field-item';
                    fieldItem.innerHTML = `
                        <h4>‡∏Ñ‡∏£‡∏π‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà ${i + 1}</h4>
                        <div class="form-group">
                            <label>‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label>
                            <select id="teacherPrefix${i}">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</option>
                                <option value="‡∏ô‡∏≤‡∏¢" ${existingData[i]?.prefix === '‡∏ô‡∏≤‡∏¢' ? 'selected' : ''}>‡∏ô‡∏≤‡∏¢</option>
                                <option value="‡∏ô‡∏≤‡∏á" ${existingData[i]?.prefix === '‡∏ô‡∏≤‡∏á' ? 'selected' : ''}>‡∏ô‡∏≤‡∏á</option>
                                <option value="‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß" ${existingData[i]?.prefix === '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß' ? 'selected' : ''}>‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option>
                                <option value="‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≠‡∏¢‡∏ï‡∏£‡∏µ" ${existingData[i]?.prefix === '‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≠‡∏¢‡∏ï‡∏£‡∏µ' ? 'selected' : ''}>‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≠‡∏¢‡∏ï‡∏£‡∏µ</option>
                                <option value="‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏ô‡∏ï‡∏£‡∏µ" ${existingData[i]?.prefix === '‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏ô‡∏ï‡∏£‡∏µ' ? 'selected' : ''}>‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏ô‡∏ï‡∏£‡∏µ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‡∏ä‡∏∑‡πà‡∏≠</label>
                            <input type="text" id="teacherFirstName${i}" placeholder="‡∏ä‡∏∑‡πà‡∏≠" value="${existingData[i]?.firstName || ''}">
                        </div>
                        <div class="form-group">
                            <label>‡∏™‡∏Å‡∏∏‡∏•</label>
                            <input type="text" id="teacherLastName${i}" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" value="${existingData[i]?.lastName || ''}">
                        </div>
                        <div class="form-group">
                            <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                            <input type="text" id="teacherPhone${i}" placeholder="0XX-XXX-XXXX" value="${existingData[i]?.phone || ''}">
                        </div>
                    `;
                    fieldsContainer.appendChild(fieldItem);
                }
            }
        }
        
        // Toggle Contest Fields
        function toggleContestField(type) {
            const checkbox = document.getElementById(`contest${type.charAt(0).toUpperCase() + type.slice(1)}`);
            const fields = document.getElementById(`${type}Fields`);
            fields.classList.toggle('hidden', !checkbox.checked);
        }
        
        // Form Submission
        document.getElementById('mainForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const intention = document.querySelector('input[name="intention"]:checked')?.value;
            if (!intention) {
                Swal.fire({
                    icon: 'warning',
                    title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå',
                    confirmButtonColor: '#ff6b00'
                });
                return;
            }
            
            const teacherCount = parseInt(document.getElementById('teacherCount').value);
            const teachers = [];
            for (let i = 0; i < teacherCount; i++) {
                const prefix = document.getElementById(`teacherPrefix${i}`)?.value || '';
                const firstName = document.getElementById(`teacherFirstName${i}`)?.value || '';
                const lastName = document.getElementById(`teacherLastName${i}`)?.value || '';
                const phone = document.getElementById(`teacherPhone${i}`)?.value || '';
                if (prefix || firstName || lastName || phone) {
                    teachers.push({ prefix, firstName, lastName, phone });
                }
            }
            
            const data = {
                schoolName: document.getElementById('schoolName').value,
                director: {
                    prefix: document.getElementById('directorPrefix').value,
                    firstName: document.getElementById('directorFirstName').value,
                    lastName: document.getElementById('directorLastName').value
                },
                totalStudents: parseInt(document.getElementById('totalStudents').value),
                intention: intention,
                joinCount: intention === 'join' ? (parseInt(document.getElementById('joinCount').value) || 0) : 0,
                notJoinReason: intention === 'notjoin' ? document.getElementById('notJoinReason').value : '',
                teachers: teachers,
                contests: {
                    singing: {
                        joined: document.getElementById('contestSinging').checked,
                        data: document.getElementById('contestSinging').checked ? {
                            prefix: document.getElementById('singingPrefix').value,
                            firstName: document.getElementById('singingFirstName').value,
                            lastName: document.getElementById('singingLastName').value,
                            grade: document.getElementById('singingGrade').value
                        } : null
                    },
                    takraw: {
                        joined: document.getElementById('contestTakraw').checked,
                        data: document.getElementById('contestTakraw').checked ? {
                            prefix: document.getElementById('takrawPrefix').value,
                            firstName: document.getElementById('takrawFirstName').value,
                            lastName: document.getElementById('takrawLastName').value,
                            grade: document.getElementById('takrawGrade').value
                        } : null
                    }
                },
                timestamp: Date.now()
            };
            
            try {
                if (currentEditId) {
                    await database.ref('registrations/' + currentEditId).update(data);
                    await Swal.fire({
                        icon: 'success',
                        title: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                        showConfirmButton: false,
                        timer: 1500
                    });
                    currentEditId = null;
                } else {
                    await database.ref('registrations').push(data);
                    await Swal.fire({
                        icon: 'success',
                        title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                        showConfirmButton: false,
                        timer: 1500
                    });
                }
                clearForm();
                switchTab(1);
                // Scroll to table after switching
                setTimeout(() => {
                    const tableContainer = document.querySelector('.table-container');
                    if (tableContainer) {
                        tableContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 300);
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: error.message,
                    confirmButtonColor: '#ff6b00'
                });
            }
        });
        
        // Clear Form
        function clearForm() {
            document.getElementById('mainForm').reset();
            document.getElementById('teacherFields').innerHTML = '';
            document.getElementById('joinCountGroup').classList.add('hidden');
            document.getElementById('notJoinReasonGroup').classList.add('hidden');
            document.getElementById('singingFields').classList.add('hidden');
            document.getElementById('takrawFields').classList.add('hidden');
            currentEditId = null;
        }
        
        // Load Summary Data
        async function loadSummaryData() {
            try {
                const snapshot = await database.ref('registrations').once('value');
                const data = snapshot.val();
                
                if (!data) {
                    document.getElementById('statSchools').textContent = '0';
                    document.getElementById('statStudents').textContent = '0';
                    document.getElementById('statContestants').textContent = '0';
                    document.getElementById('dataTable').innerHTML = '<tr><td colspan="7" style="text-align: center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
                    return;
                }
                
                const registrations = Object.entries(data).map(([id, val]) => ({ id, ...val }));
                
                // Calculate stats
                const totalSchools = registrations.length;
                const totalStudents = registrations.reduce((sum, reg) => sum + (reg.joinCount || 0), 0);
                const totalContestants = registrations.reduce((sum, reg) => {
                    let count = 0;
                    if (reg.contests?.singing?.joined) count++;
                    if (reg.contests?.takraw?.joined) count++;
                    return sum + count;
                }, 0);
                
                document.getElementById('statSchools').textContent = totalSchools;
                document.getElementById('statStudents').textContent = totalStudents;
                document.getElementById('statContestants').textContent = totalContestants;
                
                // Update chart
                updateChart(registrations);
                
                // Update table
                const tableBody = document.getElementById('dataTable');
                tableBody.innerHTML = registrations.map(reg => {
                    const teacherNames = reg.teachers?.map(t => {
                        const fullName = `${t.prefix || ''} ${t.firstName || ''} ${t.lastName || ''}`.trim();
                        return fullName || '-';
                    }).join(', ') || '-';
                    const hasPhone = reg.teachers?.some(t => t.phone);
                    
                    return `
                    <tr>
                        <td>${reg.schoolName}</td>
                        <td style="text-align: center;">${reg.totalStudents}</td>
                        <td style="text-align: center;">${reg.joinCount || 0}</td>
                        <td>${teacherNames}</td>
                        <td style="text-align: center;">
                            ${hasPhone ? `
                                <span class="phone-icon" onclick="showPhoneModal('${reg.id}')" title="‡∏î‡∏π‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå">
                                    üìû
                                </span>
                            ` : '-'}
                        </td>
                        <td style="text-align: center;">${reg.contests?.singing?.joined ? '‚úÖ' : '-'}</td>
                        <td style="text-align: center;">${reg.contests?.takraw?.joined ? '‚úÖ' : '-'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-small btn-edit" onclick="editRecord('${reg.id}')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                <button class="btn btn-small btn-delete" onclick="deleteRecord('${reg.id}')">üóëÔ∏è ‡∏•‡∏ö</button>
                            </div>
                        </td>
                    </tr>
                `}).join('');
                
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }
        
        // Update Chart
        function updateChart(registrations) {
            const ctx = document.getElementById('schoolChart').getContext('2d');
            
            if (chartInstance) {
                chartInstance.destroy();
            }
            
            const schoolData = {};
            const notJoinSchools = [];
            
            registrations.forEach(reg => {
                if (reg.intention === 'notjoin') {
                    notJoinSchools.push(reg.schoolName);
                    schoolData[reg.schoolName] = 0;
                } else {
                    schoolData[reg.schoolName] = (schoolData[reg.schoolName] || 0) + (reg.joinCount || 0);
                }
            });
            
            const labels = Object.keys(schoolData).map(name => {
                if (notJoinSchools.includes(name)) {
                    return name + ' (‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°)';
                }
                return name;
            });
            
            const values = Object.values(schoolData);
            const backgroundColors = labels.map(label => 
                label.includes('(‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°)') ? 'rgba(244, 67, 54, 0.7)' : 'rgba(255, 107, 0, 0.7)'
            );
            const borderColors = labels.map(label => 
                label.includes('(‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°)') ? '#f44336' : '#ff6b00'
            );
            
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô',
                        data: values,
                        backgroundColor: backgroundColors,
                        borderColor: borderColors,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.label.includes('(‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°)')) {
                                        return '‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°';
                                    }
                                    return '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: ' + context.parsed.y + ' ‡∏Ñ‡∏ô';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                font: {
                                    size: 12
                                },
                                color: function(context) {
                                    const label = context.tick.label;
                                    return label.includes('(‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°)') ? '#f44336' : '#333';
                                }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
        
        // Edit Record
        async function editRecord(id) {
            try {
                const snapshot = await database.ref('registrations/' + id).once('value');
                const data = snapshot.val();
                
                if (!data) return;
                
                currentEditId = id;
                
                // Fill form
                document.getElementById('schoolName').value = data.schoolName;
                
                // Director info
                if (data.director) {
                    document.getElementById('directorPrefix').value = data.director.prefix || '';
                    document.getElementById('directorFirstName').value = data.director.firstName || '';
                    document.getElementById('directorLastName').value = data.director.lastName || '';
                }
                
                document.getElementById('totalStudents').value = data.totalStudents;
                
                // Set intention
                document.querySelector(`input[name="intention"][value="${data.intention}"]`).checked = true;
                toggleIntentionFields();
                
                if (data.intention === 'join') {
                    document.getElementById('joinCount').value = data.joinCount || 0;
                } else {
                    document.getElementById('notJoinReason').value = data.notJoinReason || '';
                }
                
                // Set teachers
                document.getElementById('teacherCount').value = data.teachers?.length || 0;
                generateTeacherFields();
                data.teachers?.forEach((teacher, i) => {
                    document.getElementById(`teacherPrefix${i}`).value = teacher.prefix || '';
                    document.getElementById(`teacherFirstName${i}`).value = teacher.firstName || '';
                    document.getElementById(`teacherLastName${i}`).value = teacher.lastName || '';
                    document.getElementById(`teacherPhone${i}`).value = teacher.phone || '';
                });
                
                // Set contests
                if (data.contests?.singing?.joined) {
                    document.getElementById('contestSinging').checked = true;
                    toggleContestField('singing');
                    const s = data.contests.singing.data;
                    document.getElementById('singingPrefix').value = s.prefix || '';
                    document.getElementById('singingFirstName').value = s.firstName || '';
                    document.getElementById('singingLastName').value = s.lastName || '';
                    document.getElementById('singingGrade').value = s.grade || '';
                }
                
                if (data.contests?.takraw?.joined) {
                    document.getElementById('contestTakraw').checked = true;
                    toggleContestField('takraw');
                    const t = data.contests.takraw.data;
                    document.getElementById('takrawPrefix').value = t.prefix || '';
                    document.getElementById('takrawFirstName').value = t.firstName || '';
                    document.getElementById('takrawLastName').value = t.lastName || '';
                    document.getElementById('takrawGrade').value = t.grade || '';
                }
                
                switchTab(0);
                window.scrollTo(0, 0);
                
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: error.message,
                    confirmButtonColor: '#ff6b00'
                });
            }
        }
        
        // Delete Record
        async function deleteRecord(id) {
            const result = await Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',
                text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#f44336',
                cancelButtonColor: '#999',
                confirmButtonText: '‡∏•‡∏ö',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            });
            
            if (!result.isConfirmed) return;
            
            try {
                await database.ref('registrations/' + id).remove();
                await Swal.fire({
                    icon: 'success',
                    title: '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                    showConfirmButton: false,
                    timer: 1500
                });
                loadSummaryData();
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: error.message,
                    confirmButtonColor: '#ff6b00'
                });
            }
        }
        
        // Print Registry
        async function printRegistry(type) {
            try {
                const snapshot = await database.ref('registrations').once('value');
                const data = snapshot.val();
                
                if (!data) {
                    Swal.fire({
                        icon: 'warning',
                        title: '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                        confirmButtonColor: '#ff6b00'
                    });
                    return;
                }
                
                const registrations = Object.values(data).filter(reg => 
                    reg.contests?.[type]?.joined
                );
                
                if (registrations.length === 0) {
                    Swal.fire({
                        icon: 'info',
                        title: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                        text: `‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô${type === 'singing' ? '‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á' : '‡πÄ‡∏î‡∏≤‡∏∞‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠'}`,
                        confirmButtonColor: '#ff6b00'
                    });
                    return;
                }
                
                // Get event logo
                let eventLogoUrl = '';
                try {
                    const logoSnapshot = await database.ref('admin/eventLogo').once('value');
                    eventLogoUrl = logoSnapshot.val() || '';
                } catch (e) {}
                
                const contestName = type === 'singing' ? '‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á‡∏•‡∏π‡∏Å‡∏ó‡∏∏‡πà‡∏á' : '‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÄ‡∏î‡∏≤‡∏∞‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠';
                
                let html = `
                    <div class="print-document">
                        <div class="print-header">
                            <img src="https://nonthaphathr.github.io/uploadimg/logoschool.png" alt="‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">
                            ${eventLogoUrl ? `<img src="${eventLogoUrl}" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏á‡∏≤‡∏ô" style="margin-left: 20px;">` : ''}
                            <h2>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏∏‡∏°‡∏ó‡∏≠‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</h2>
                            <h2>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏•‡∏á‡∏ô‡∏≤‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤${contestName}</h2>
                        </div>
                        <table class="print-table">
                            <thead>
                                <tr>
                                    <th style="width: 40px;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                                    <th>‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</th>
                                    <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                                    <th>‡∏™‡∏Å‡∏∏‡∏•</th>
                                    <th>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                                    <th style="width: 150px;">‡∏•‡∏á‡∏ô‡∏≤‡∏°</th>
                                    <th style="width: 100px;">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                registrations.forEach((reg, index) => {
                    const contestant = reg.contests[type].data;
                    html += `
                        <tr>
                            <td style="text-align: center;">${index + 1}</td>
                            <td>${contestant.prefix || ''}</td>
                            <td>${contestant.firstName || ''}</td>
                            <td>${contestant.lastName || ''}</td>
                            <td>${reg.schoolName}</td>
                            <td></td>
                            <td></td>
                        </tr>
                    `;
                });
                
                // Add 15 empty rows for walk-in
                for (let i = 0; i < 15; i++) {
                    html += `
                        <tr>
                            <td style="text-align: center;">${registrations.length + i + 1}</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    `;
                }
                
                html += `
                            </tbody>
                        </table>
                        <div class="signature-section">
                            <div class="signature-box">
                                <div class="signature-line"></div>
                                <p>‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>
                            </div>
                            <div class="signature-box">
                                <div class="signature-line"></div>
                                <p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</p>
                            </div>
                        </div>
                    </div>
                `;
                
                const printArea = document.getElementById('printArea');
                printArea.innerHTML = html;
                printArea.style.display = 'block';
                
                window.print();
                
                setTimeout(() => {
                    printArea.style.display = 'none';
                }, 1000);
                
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: error.message,
                    confirmButtonColor: '#ff6b00'
                });
            }
        }
        
        // Export to Excel
        async function exportToExcel() {
            try {
                const snapshot = await database.ref('registrations').once('value');
                const data = snapshot.val();
                
                if (!data) {
                    Swal.fire({
                        icon: 'warning',
                        title: '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                        confirmButtonColor: '#ff6b00'
                    });
                    return;
                }
                
                const registrations = Object.values(data);
                
                const excelData = registrations.map(reg => ({
                    '‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô': reg.schoolName,
                    '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£': reg.director ? `${reg.director.prefix || ''} ${reg.director.firstName || ''} ${reg.director.lastName || ''}`.trim() : '',
                    '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏õ.6': reg.totalStudents,
                    '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå': reg.intention === 'join' ? '‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°' : '‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°',
                    '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°': reg.joinCount || 0,
                    '‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°': reg.notJoinReason || '',
                    '‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•': reg.teachers?.map(t => `${t.prefix || ''} ${t.firstName || ''} ${t.lastName || ''}`.trim()).join(', ') || '',
                    '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£': reg.teachers?.map(t => t.phone).join(', ') || '',
                    '‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á': reg.contests?.singing?.joined ? '‡πÉ‡∏ä‡πà' : '‡πÑ‡∏°‡πà',
                    '‡πÄ‡∏î‡∏≤‡∏∞‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠': reg.contests?.takraw?.joined ? '‡πÉ‡∏ä‡πà' : '‡πÑ‡∏°‡πà'
                }));
                
                const ws = XLSX.utils.json_to_sheet(excelData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô');
                
                XLSX.writeFile(wb, `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡πâ‡∏≤‡∏ô_${new Date().toLocaleDateString('th-TH')}.xlsx`);
                
                Swal.fire({
                    icon: 'success',
                    title: '‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Excel ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                    showConfirmButton: false,
                    timer: 1500
                });
                
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: error.message,
                    confirmButtonColor: '#ff6b00'
                });
            }
        }
        
        // Admin Modal
        function openAdminModal() {
            document.getElementById('adminModal').style.display = 'block';
        }
        
        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminPasswordSection').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
        }
        
        function handleAdminPasswordEnter(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                checkAdminPassword();
            }
        }
        
        function checkAdminPassword() {
            const password = document.getElementById('adminPassword').value;
            if (password === '0000') {
                document.getElementById('adminPasswordSection').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                loadAdminSettings();
                Swal.fire({
                    icon: 'success',
                    title: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                    showConfirmButton: false,
                    timer: 1000
                });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                    confirmButtonColor: '#ff6b00'
                });
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
            }
        }
        
        async function loadAdminSettings() {
            try {
                const snapshot = await database.ref('admin').once('value');
                const settings = snapshot.val() || {};
                
                document.getElementById('criteriaLink').value = settings.criteriaLink || '';
                document.getElementById('announcementText').value = settings.announcementText || '';
                document.getElementById('showAnnouncement').checked = settings.showAnnouncement || false;
                
                if (settings.eventLogo) {
                    document.getElementById('currentLogo').innerHTML = `
                        <img src="${settings.eventLogo}" style="max-width: 200px; border-radius: 10px;">
                    `;
                }
            } catch (error) {
                console.error('Error loading admin settings:', error);
            }
        }
        
        async function uploadEventLogo() {
            const file = document.getElementById('eventLogo').files[0];
            if (!file) return;
            
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });
            
            try {
                const storageRef = storage.ref('eventLogo/' + Date.now() + '_' + file.name);
                await storageRef.put(file);
                const url = await storageRef.getDownloadURL();
                
                await database.ref('admin/eventLogo').set(url);
                
                Swal.fire({
                    icon: 'success',
                    title: '‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                    showConfirmButton: false,
                    timer: 1500
                });
                
                loadAdminSettings();
                loadEventLogo();
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: error.message,
                    confirmButtonColor: '#ff6b00'
                });
            }
        }
        
        async function saveAdminSettings() {
            try {
                await database.ref('admin').update({
                    criteriaLink: document.getElementById('criteriaLink').value,
                    announcementText: document.getElementById('announcementText').value,
                    showAnnouncement: document.getElementById('showAnnouncement').checked
                });
                
                Swal.fire({
                    icon: 'success',
                    title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                    showConfirmButton: false,
                    timer: 1500
                });
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: error.message,
                    confirmButtonColor: '#ff6b00'
                });
            }
        }
        
        // Load Event Logo
        async function loadEventLogo() {
            try {
                const snapshot = await database.ref('admin/eventLogo').once('value');
                const logoUrl = snapshot.val();
                
                if (logoUrl) {
                    const logoContainer = document.getElementById('headerLogos');
                    const existingEventLogo = logoContainer.querySelector('.event-logo');
                    
                    if (existingEventLogo) {
                        existingEventLogo.src = logoUrl;
                    } else {
                        const img = document.createElement('img');
                        img.src = logoUrl;
                        img.className = 'event-logo';
                        logoContainer.appendChild(img);
                    }
                }
            } catch (error) {
                console.error('Error loading event logo:', error);
            }
        }
        
        // Show Announcement
        async function showAnnouncement() {
            try {
                const snapshot = await database.ref('admin').once('value');
                const settings = snapshot.val() || {};
                
                if (settings.showAnnouncement && settings.announcementText) {
                    document.getElementById('announcementContent').textContent = settings.announcementText;
                    document.getElementById('announcementModal').style.display = 'block';
                }
            } catch (error) {
                console.error('Error showing announcement:', error);
            }
        }
        
        function closeAnnouncementModal() {
            document.getElementById('announcementModal').style.display = 'none';
        }
        
        // Phone Modal
        async function showPhoneModal(id) {
            try {
                const snapshot = await database.ref('registrations/' + id).once('value');
                const data = snapshot.val();
                
                if (!data || !data.teachers) return;
                
                const phoneList = document.getElementById('phoneList');
                phoneList.innerHTML = data.teachers
                    .filter(t => t.phone)
                    .map((teacher, index) => {
                        const fullName = `${teacher.prefix || ''} ${teacher.firstName || ''} ${teacher.lastName || ''}`.trim();
                        const displayName = fullName || `‡∏Ñ‡∏£‡∏π‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà ${index + 1}`;
                        return `
                        <div class="phone-item">
                            <div>
                                <strong>${displayName}</strong><br>
                                <span class="phone-number">${teacher.phone}</span>
                            </div>
                            <button class="copy-btn" onclick="copyPhone('${teacher.phone}')">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
                        </div>
                    `}).join('');
                
                document.getElementById('phoneModal').style.display = 'block';
            } catch (error) {
                console.error('Error showing phone modal:', error);
            }
        }
        
        function closePhoneModal() {
            document.getElementById('phoneModal').style.display = 'none';
        }
        
        function copyPhone(phone) {
            navigator.clipboard.writeText(phone).then(() => {
                Swal.fire({
                    icon: 'success',
                    title: '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                    text: phone,
                    showConfirmButton: false,
                    timer: 1500
                });
            }).catch(err => {
                console.error('Error copying:', err);
            });
        }
        
        // Criteria Link
        async function openCriteriaLink(event) {
            event.preventDefault();
            try {
                const snapshot = await database.ref('admin/criteriaLink').once('value');
                const link = snapshot.val();
                
                if (link) {
                    window.open(link, '_blank');
                } else {
                    Swal.fire({
                        icon: 'info',
                        title: '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏•‡∏¥‡∏á‡∏Å‡πå',
                        text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î',
                        confirmButtonColor: '#ff6b00'
                    });
                }
            } catch (error) {
                console.error('Error opening criteria link:', error);
            }
        }
        
        // Initialize
        window.addEventListener('load', () => {
            loadEventLogo();
            showAnnouncement();
        });
        
        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        };
    </script>
</body>
</html>
